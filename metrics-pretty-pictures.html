<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Metrics and pretty pictures - The Nimbus Beacon Chain Book</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><strong aria-hidden="true">2.</strong> Hardware requirements</li><li class="chapter-item expanded "><a href="install.html"><strong aria-hidden="true">3.</strong> Install dependencies</a></li><li class="chapter-item expanded "><a href="build.html"><strong aria-hidden="true">4.</strong> Build the beacon node</a></li><li class="chapter-item expanded "><a href="eth1.html"><strong aria-hidden="true">5.</strong> Run an eth1 node</a></li><li class="chapter-item expanded "><a href="start-syncing.html"><strong aria-hidden="true">6.</strong> Sync the beacon node</a></li><li class="chapter-item expanded "><a href="deposit.html"><strong aria-hidden="true">7.</strong> Make a deposit</a></li><li class="chapter-item expanded "><a href="keys.html"><strong aria-hidden="true">8.</strong> Manage your keys</a></li><li class="chapter-item expanded "><a href="connect-eth2.html"><strong aria-hidden="true">9.</strong> Connect your validator to eth2</a></li><li class="chapter-item expanded "><a href="keep-an-eye.html"><strong aria-hidden="true">10.</strong> Keep an eye on your validator</a></li><li class="chapter-item expanded "><a href="keep-updated.html"><strong aria-hidden="true">11.</strong> Keep Nimbus updated</a></li><li class="chapter-item expanded affix "><li class="part-title">Volume 2</li><li class="chapter-item expanded "><strong aria-hidden="true">12.</strong> Useful pre-genesis checks</li><li class="chapter-item expanded "><a href="troubleshooting.html"><strong aria-hidden="true">13.</strong> Troubleshooting</a></li><li class="chapter-item expanded "><a href="metrics-pretty-pictures.html" class="active"><strong aria-hidden="true">14.</strong> Metrics and pretty pictures</a></li><li class="chapter-item expanded "><a href="eth2-stats.html"><strong aria-hidden="true">15.</strong> Network stats + monitoring</a></li><li class="chapter-item expanded "><a href="pi-guide.html"><strong aria-hidden="true">16.</strong> Run your node on a Raspberry Pi</a></li><li class="chapter-item expanded "><a href="graffiti.html"><strong aria-hidden="true">17.</strong> Graffiti the blockchain</a></li><li class="chapter-item expanded "><strong aria-hidden="true">18.</strong> Run just the beacon node</li><li class="chapter-item expanded "><strong aria-hidden="true">19.</strong> Switch between clients</li><li class="chapter-item expanded "><a href="infura-guide.html"><strong aria-hidden="true">20.</strong> Your own Infura endpoint</a></li><li class="chapter-item expanded affix "><li class="part-title">Volume 3</li><li class="chapter-item expanded "><a href="advanced.html"><strong aria-hidden="true">21.</strong> Advanced options</a></li><li class="chapter-item expanded "><a href="api.html"><strong aria-hidden="true">22.</strong> API</a></li><li class="chapter-item expanded "><a href="developers.html"><strong aria-hidden="true">23.</strong> For developers</a></li><li class="chapter-item expanded "><a href="beacon-node-systemd.html"><strong aria-hidden="true">24.</strong> Set up a systemd service</a></li><li class="chapter-item expanded "><strong aria-hidden="true">25.</strong> Windows users</li><li class="chapter-item expanded "><a href="faq.html"><strong aria-hidden="true">26.</strong> FAQ</a></li><li class="chapter-item expanded "><a href="contribute.html"><strong aria-hidden="true">27.</strong> Contribute</a></li><li class="chapter-item expanded "><a href="resources.html"><strong aria-hidden="true">28.</strong> Resources</a></li><li class="chapter-item expanded affix "><li class="part-title">Archived</li><li class="chapter-item expanded "><a href="medalla.html"><strong aria-hidden="true">29.</strong> Become a Medalla validator</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">The Nimbus Beacon Chain Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#metrics-and-pretty-pictures" id="metrics-and-pretty-pictures">Metrics and pretty pictures</a></h1>
<blockquote>
<p>⚠️  This page concerns the Medalla testnet. If you have made a mainnet deposit, you do not need to connect to eth2 quite yet. Mainnet <a href="https://hackmd.io/@benjaminion/genesis">Genesis</a> date has been set to <a href="https://blog.ethereum.org/2020/11/04/eth2-quick-update-no-19/">December 1st</a>. This page will be updated nearer the time.</p>
</blockquote>
<p>In this page we'll cover how to use  Grafana and Prometheus to help you visualise important real-time metrics concerning your validator and/or beacon node.</p>
<p>Prometheus is an open-source systems monitoring and alerting toolkit. It runs as a service on your computer and its job is to capture metrics. You can find more information about Prometheus <a href="https://prometheus.io/docs/introduction/overview/">here</a>.</p>
<p>Grafana is a tool for beautiful dashboard monitoring that works well with Prometheus. You can learn more about Grafana <a href="https://github.com/grafana/grafana">here</a>.</p>
<h2><a class="header" href="#simple-metrics" id="simple-metrics">Simple metrics</a></h2>
<p>The easiest way to see metrics concerning your validator / node is to run the beacon node with the <code>NIMFLAGS=&quot;-d:insecure&quot;</code> flag. For example, to enable metrics for a <code>medalla</code> validator, run:</p>
<pre><code>make NIMFLAGS=&quot;-d:insecure&quot; medalla
</code></pre>
<blockquote>
<p><strong>Note:</strong> Metrics are not included in the binary by default. The <code>NIMFLAGS=&quot;-d:insecure&quot;</code> is needed because we consider the HTTP server that needs to start to serve the metrics to be insecure (without this flag it won't launch properly). As such, we recommend you make sure port 8008 is protected.</p>
</blockquote>
<p>Now visit <a href="http://127.0.0.1:8008/metrics">http://127.0.0.1:8008/metrics</a> to see the raw metrics. You should see a plaintext page that looks something like this:</p>
<pre><code># HELP nim_runtime_info Nim runtime info
# TYPE nim_runtime_info gauge
nim_gc_mem_bytes 6275072.0
nim_gc_mem_occupied_bytes 1881384.0
nim_gc_heap_instance_occupied_bytes{type_name=&quot;KeyValuePairSeq[digest.Eth2Digest, block_pools_types.BlockRef]&quot;} 25165856.0
nim_gc_heap_instance_occupied_bytes{type_name=&quot;BlockRef&quot;} 17284608.0
nim_gc_heap_instance_occupied_bytes{type_name=&quot;string&quot;} 6264507.0
nim_gc_heap_instance_occupied_bytes{type_name=&quot;seq[SelectorKey[asyncdispatch.AsyncData]]&quot;} 409632.0
nim_gc_heap_instance_occupied_bytes{type_name=&quot;OrderedKeyValuePairSeq[Labels, seq[Metric]]&quot;} 122720.0
nim_gc_heap_instance_occupied_bytes{type_name=&quot;Future[system.void]&quot;} 79848.0
nim_gc_heap_instance_occupied_bytes{type_name=&quot;anon ref object from /Users/hackingresearch/nimbus/clone/nim-beacon-chain/vendor/nimbus-build-system/vendor/Nim/lib/pure/asyncmacro.nim(319, 33)&quot;} 65664.0
nim_gc_heap_instance_occupied_bytes{type_name=&quot;anon ref object from /Users/hackingresearch/nimbus/clone/nim-beacon-chain/vendor/nimbus-build-system/vendor/Nim/lib/pure/asyncnet.nim(506, 11)&quot;} 43776.0
nim_gc_heap_instance_occupied_bytes{type_name=&quot;seq[byte]&quot;} 37236.0
nim_gc_heap_instance_occupied_bytes{type_name=&quot;seq[TrustedAttestation]&quot;} 29728.0

...
</code></pre>
<p>Unfortunately, this simple method only offers one snapshot in time (you'll need to keep refreshing to see the data update) which means it's impossible to see a useful history of the metrics. In short, it's far from optimal from an information design point of view.</p>
<p>In order to settle on a better solution, we'll need the help of two external projects -- Prometheus and Grafana.</p>
<h2><a class="header" href="#prometheus-and-grafana" id="prometheus-and-grafana">Prometheus and Grafana</a></h2>
<p>The following steps will take you through how to use Prometheus and Grafana to spin up a beautiful and useful monitoring dashboard for your validator and beacon node.</p>
<h3><a class="header" href="#steps" id="steps">Steps</a></h3>
<h4><a class="header" href="#1-download-prometheus" id="1-download-prometheus">1. Download Prometheus</a></h4>
<p>Download and extract the <a href="https://prometheus.io/download/">latest release</a> of Prometheus for your platform:</p>
<pre><code>tar xvfz prometheus-*.tar.gz
cd prometheus-*
</code></pre>
<blockquote>
<p><strong>Note:</strong> If you use a package manager, you can also download Prometheus that way -- for example <code>apt-get install prometheus</code> on Ubuntu, or <code>brew install prometheus</code> on MacOS, should do the trick.</p>
</blockquote>
<h4><a class="header" href="#2-copy-the-binary" id="2-copy-the-binary">2. Copy the binary</a></h4>
<p>The Prometheus server is a single binary called prometheus (or prometheus.exe on Microsoft Windows). Copy it over to <a href="https://unix.stackexchange.com/questions/4186/what-is-usr-local-bin"><code>/usr/local/bin</code></a></p>
<pre><code>cp prometheus-2.20.1.linux-amd64/prometheus /usr/local/bin/
</code></pre>
<h4><a class="header" href="#3-run-prometheus-with-the-default-configuration-file" id="3-run-prometheus-with-the-default-configuration-file">3. Run Prometheus with the default configuration file</a></h4>
<p>Prometheus relies on a YAML configuration file to let it know where, and how often, to scrape data.</p>
<p><code>nimbus-eth2</code> generates an appropriate configuration file (<code>prometheseus.yml</code>) when you build the beacon node. If you're running the <code>medalla</code> testnet you'll find this in <code>build/data/shared_medalla_0</code>.</p>
<p>To run Prometheus with the default config file:</p>
<pre><code>cd build/data/shared_medalla_0
prometheus --config.file=./prometheus.yml --storage.tsdb.path=./prometheus
# when starting multiple nodes at the same time, just use the config file from the one with the highest ID
</code></pre>
<h4><a class="header" href="#4-download-grafana" id="4-download-grafana">4. Download Grafana</a></h4>
<p><a href="(https://grafana.com/grafana/download?platform=linux)">Download the latest release</a> of Grafana for your platform.</p>
<blockquote>
<p><strong>Note:</strong> If you use a package manager, you can also download Grafana that way -- for example <code>apt-get install grafana</code> on Ubuntu, or <code>brew install grafana</code> on MacOS, should do the trick.</p>
</blockquote>
<h4><a class="header" href="#5-install-and-start-grafana" id="5-install-and-start-grafana">5. Install and start Grafana</a></h4>
<p>Follow <a href="https://grafana.com/docs/grafana/latest/installation/">the instructions for your platform</a> to install and start Grafana.</p>
<h4><a class="header" href="#6-configure-login" id="6-configure-login">6. Configure login</a></h4>
<p>Go to <a href="http://localhost:3000/">http://localhost:3000/</a>, you should see a Grafana login screen that looks like this</p>
<p><img src="https://i.imgur.com/jcP1qWl.png" alt="" /></p>
<p>Type in <code>admin</code> for both the username and password. You'll be asked to change the password (we recommend you do so).</p>
<h4><a class="header" href="#7-add-a-data-source" id="7-add-a-data-source">7. Add a data source</a></h4>
<p>Hover your mouse over the gear icon in the left menu bar, and click on the <code>Data Sources</code> option in the sub-menu that pops up.</p>
<p><img src="https://i.imgur.com/0Xsgx61.png" alt="" /></p>
<p>Now click on the <code>Add Data Source</code> button in the center of the screen</p>
<p><img src="https://i.imgur.com/YRVJjdD.png" alt="" /></p>
<p>Select <code>Prometheus</code></p>
<p><img src="https://i.imgur.com/YpwThOr.png" alt="" /></p>
<p>Enter <code>http://localhost:9090</code> in the URL field</p>
<p><img src="https://i.imgur.com/PtVOnur.png" alt="" /></p>
<p>Scroll to the bottom and click on <code>Save and Test</code></p>
<p><img src="https://i.imgur.com/GJVdwaK.png" alt="" /></p>
<p>If everything is working correctly you should see a green <code>Data source is working</code> box pop up</p>
<p><img src="https://i.imgur.com/vf5ahNA.png" alt="" /></p>
<h4><a class="header" href="#8-import-a-dashboard" id="8-import-a-dashboard">8. Import a dashboard</a></h4>
<p>Now, let's import a dashboard; hover your mouse over the <code>+</code> icon in the left menu bar and select <code>import</code> from the pop-up menu</p>
<p><img src="https://i.imgur.com/WnnAcUR.png" alt="" /></p>
<p>Click on <code>Upload JSON file</code></p>
<p><img src="https://i.imgur.com/l65ICZ2.png" alt="" /></p>
<p>Select the <code>beacon_nodes_Grafana_dashboard.json</code>  from the <code>nimbus-eth2/grafana/</code> folder and click on <code>Import</code></p>
<p><img src="https://i.imgur.com/SoU5Isz.png" alt="" /></p>
<p>You'll be directed to the dashboard where you'll be able to gain insights into the performance of <code>nimbus-eth2</code> and your validators</p>
<p><img src="https://i.imgur.com/aIfJ1iT.png" alt="" /></p>
<blockquote>
<p><strong>Note:</strong> the dashboard is very much a work in progress. Some of the highlights right now include received and proposed blocks, received and sent attestations, peers, memory and cpu usage stats. But keep an eye out for additional metrics in the near future.</p>
</blockquote>
<p>And voila! That's all there is to it :)</p>
<h2><a class="header" href="#enabling-mobile-alerts" id="enabling-mobile-alerts">Enabling mobile alerts</a></h2>
<h3><a class="header" href="#telegram" id="telegram">Telegram</a></h3>
<p>TODO</p>
<h3><a class="header" href="#discord" id="discord">Discord</a></h3>
<p>TODO</p>
<h2><a class="header" href="#additional-resources" id="additional-resources">Additional resources</a></h2>
<ul>
<li><a href="https://medium.com/@SomerEsat/guide-to-staking-on-ethereum-2-0-ubuntu-medalla-nimbus-5f4b2b0f2d7c">Guide to Staking on Ethereum 2.0 (Ubuntu/Medalla/Nimbus)</a>: a guide by an outside contributer that contains some very informative sections on both Prometheus and Grafana. We strongly recommend reading through the relevant sections if you're using a linux device and/or using <code>systemd</code>.</li>
<li><a href="https://metrics.status.im/d/pgeNfj2Wz23/nimbus-testnet3?orgId=1&amp;from=now-6h&amp;to=now&amp;var-container=beacon-node-testnet3&amp;var-instance=node-03.aws-eu-central-1a.nimbus.test">Our dashboard</a> (AWS Medalla nodes)</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="troubleshooting.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="eth2-stats.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="troubleshooting.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="eth2-stats.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
